# Custom Message Format Sample
Sample code demonstrating how to send and process events in a custom format.  This sample extends the HelloWorld sample but uses a custom message formar for the events.

## Building the custom codec
The custom codec class must implement two static methods: `encode(data, timestamp=None)` and `decode(message)`.  The encode method must return a string representation of the message and accept two parameters:
* a Python dict containing the data to be encoded
* an optional timestamp for the event that will be transmitted as part of the encoded message.

```python
@staticmethod
def encode(data=None, timestamp=None):
    return data['hello'] + "," + str(data['x'])
```

The decode method must be able to convert the string generated by `encode()` into an instance of `wiotp.sdk.Message`.  In this simple example you can see that no timestamp information is transmitted in the event, the decoder simply uses the current time as the timestamp for the message.

```python
@staticmethod
def decode(message):
    (hello, x) = message.payload.split(",")
    
    data = {}
    data['hello'] = hello
    data['x'] = x
    
    timestamp = datetime.now(pytz.timezone('UTC'))
    
    return Message(data, timestamp)
```

## Registering the custom codec with the application client
Using your custom message format encoder is simple.  The `setMessageCodec()` method in each of the Application, Device, & Gateway clients allows you to define a different module for each message format string.

```python
# Import the class
from myCustomCodec import MyCodec
import wiotp.sdk.application

appCli = wiotp.sdk.application.Client(appOptions)
appCli.setMessageCodec("custom", MyCodec)
appCli.connect()
```


## Registering the custom codec with the device client
```python
# Import the class
from myCustomCodec import MyCodec
import wiotp.sdk.device

# Initialize the device client.
deviceCli = wiotp.sdk.device.DeviceClient(deviceOptions)
deviceCli.setMessageCodec("custom", MyCodec)
deviceCli.connect()
```

## Usage

```
python customCodecSample.py
Received live data from ca72af10ef14 (helloWorldDevice) sent at 19:33:27: hello=world x=0
Received live data from ca72af10ef14 (helloWorldDevice) sent at 19:33:28: hello=world x=1
Received live data from ca72af10ef14 (helloWorldDevice) sent at 19:33:29: hello=world x=2
Received live data from ca72af10ef14 (helloWorldDevice) sent at 19:33:30: hello=world x=3
Received live data from ca72af10ef14 (helloWorldDevice) sent at 19:33:31: hello=world x=4
Received live data from ca72af10ef14 (helloWorldDevice) sent at 19:33:32: hello=world x=5
Received live data from ca72af10ef14 (helloWorldDevice) sent at 19:33:33: hello=world x=6
Received live data from ca72af10ef14 (helloWorldDevice) sent at 19:33:34: hello=world x=7
Received live data from ca72af10ef14 (helloWorldDevice) sent at 19:33:35: hello=world x=8
Received live data from ca72af10ef14 (helloWorldDevice) sent at 19:33:36: hello=world x=9
```

